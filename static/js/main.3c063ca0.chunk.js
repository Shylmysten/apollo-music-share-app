(this["webpackJsonpapollo-music-share"]=this["webpackJsonpapollo-music-share"]||[]).push([[0],{179:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(18),c=n.n(r),o=n(16),s=n(213),l=n(216),u=n(217),d=n(133),j=n(218),b=n(6),p=Object(s.a)((function(e){return{title:{marginLeft:e.spacing(3)}}}));var O,g,h,m=function(){var e=p();return Object(b.jsx)(l.a,{color:"primary",position:"fixed",children:Object(b.jsxs)(u.a,{children:[Object(b.jsx)(j.a,{}),Object(b.jsx)(d.a,{className:e.title,variant:"h6",component:"h1",children:"Apollo Music Share"})]})})},x=n(52),f=n.n(x),y=n(75),v=n(85),S=n(25),w=n(252),N=n(219),C=n(220),k=n(248),I=n(221),_=n(222),q=n(223),P=n(224),E=n(225),T=n(86),A=n.n(T),F=n(120),$=n.n(F),G=n(121),Q=n.n(G),R=n(247),D=n(43),M=n(249),U=Object(M.a)(O||(O=Object(D.a)(["\n  mutation addOrRemoveFromQueue($input: SongInput!) {\n    addOrRemoveFromQueue(input: $input) @client\n  }\n"]))),L=Object(M.a)(g||(g=Object(D.a)(["\nmutation deleteSong($id: uuid!) {\n  delete_songs(where: {id: {_eq: $id}}) {\n    returning {\n      id\n      duration\n      create_at\n      artist\n      thumbnail\n      title\n      url\n    }\n  }\n}"]))),B=Object(M.a)(h||(h=Object(D.a)(["\nmutation addSong(\n  $title: String!, \n  $artist: String!, \n  $thumbnail: String!, \n  $duration: Float!, \n  $url: String!\n  ) {\n    insert_songs(\n      objects: {\n        title: $title, \n        artist: $artist, \n        thumbnail: $thumbnail, \n        duration: $duration, \n        url: $url\n      }\n    ) {\n      affected_rows\n    }\n  }"]))),H=Object(s.a)((function(e){return{container:{display:"flex",alignItems:"center"},urlInput:{margin:e.spacing(1)},addSongButton:{margin:e.spacing(1)},dialog:{textAlign:"center"},thumbnail:{width:"90%"}}})),J={duration:0,title:"",artist:"",thumbnail:""};var V,z=function(){var e=H(),t=Object(R.a)(B),n=Object(o.a)(t,2),a=n[0],r=n[1].error,c=i.a.useState(""),s=Object(o.a)(c,2),l=s[0],u=s[1],d=i.a.useState(!1),j=Object(o.a)(d,2),p=j[0],O=j[1],g=i.a.useState(!1),h=Object(o.a)(g,2),m=h[0],x=h[1],T=i.a.useState(J),F=Object(o.a)(T,2),G=F[0],D=F[1];function M(e){var t=e.target,n=t.name,a=t.value;D((function(e){return Object(S.a)(Object(S.a)({},e),{},Object(v.a)({},n,a))}))}function U(){x(!1)}function L(){return(L=Object(y.a)(f.a.mark((function e(t){var n,a,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.player,!(a=n.player.player).getVideoData){e.next=6;break}i=z(a),e.next=10;break;case 6:if(!a.getCurrentSound){e.next=10;break}return e.next=9,W(a);case 9:i=e.sent;case 10:D(Object(S.a)(Object(S.a)({},i),{},{url:l}));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(){return(V=Object(y.a)(f.a.mark((function e(){var t,n,i,r,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=G.url,n=G.thumbnail,i=G.duration,r=G.title,c=G.artist,e.next=4,a({variables:{url:t.length>0?t:null,thumbnail:n.length>0?n:null,duration:i>0?i:null,title:r.length>0?r:null,artist:c.length>0?c:null}});case 4:U(),D(J),u(""),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error adding song",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function z(e){var t=e.getDuration(),n=e.getVideoData(),a=n.title,i=n.video_id;return{duration:t,title:a,artist:n.author,thumbnail:"http://img.youtube.com/vi/".concat(i,"/0.jpg")}}function W(e){return new Promise((function(t){e.getCurrentSound((function(e){e&&t({duration:Number(e.duration/1e3),title:e.title,artist:e.user.username,thumbnail:e.artwork_url.replace("-large","-t500x500")})}))}))}function Y(e){return r&&r.graphQLErrors[0].extensions.path.includes(e)}i.a.useEffect((function(){var e=$.a.canPlay(l)||Q.a.canPlay(l);O(e)}),[l]);var K=G.thumbnail,X=G.title,Z=G.artist;return Object(b.jsxs)("div",{className:e.container,children:[Object(b.jsxs)(w.a,{className:e.dialog,open:m,onClose:U,children:[Object(b.jsx)(N.a,{children:"Edit Song"}),Object(b.jsxs)(C.a,{children:[Object(b.jsx)("img",{className:e.thumbnail,src:K,alt:"Song Thumbnail"}),Object(b.jsx)(k.a,{value:X,onChange:M,margin:"dense",name:"title",label:"Title",fullWidth:!0,error:Y("title"),helperText:Y("title")&&"Fill out field"}),Object(b.jsx)(k.a,{value:Z,onChange:M,margin:"dense",name:"artist",label:"Artist",fullWidth:!0,error:Y("artist"),helperText:Y("artist")&&"Fill out field"}),Object(b.jsx)(k.a,{value:K,onChange:M,margin:"dense",name:"thumbnail",label:"Thumbnail",fullWidth:!0,error:Y("thumbnail"),helperText:Y("thumbnail")&&"Fill out field"})]}),Object(b.jsxs)(I.a,{children:[Object(b.jsx)(_.a,{onClick:U,color:"secondary",children:"Cancel"}),Object(b.jsx)(_.a,{onClick:function(){return V.apply(this,arguments)},variant:"outlined",color:"primary",children:"Add Song"})]})]}),Object(b.jsx)(k.a,{className:e.urlInput,onChangeCapture:function(e){return u(e.target.value)},value:l,placeholder:"Add YouTube or Soundcloud Url",fullWidth:!0,margin:"normal",type:"url",InputProps:{startAdornment:Object(b.jsx)(q.a,{position:"start",children:Object(b.jsx)(P.a,{})})}}),Object(b.jsx)(_.a,{disabled:!p,className:e.addSongButton,onClick:function(){return x(!0)},variant:"contained",color:"primary",endIcon:Object(b.jsx)(E.a,{}),children:"Add"}),Object(b.jsx)(A.a,{url:l,hidden:!0,onReady:function(e){return L.apply(this,arguments)}})]})},W=n(227),Y=n(228),K=n(229),X=n(230),Z=n(231),ee=n(232),te=n(233),ne=n(234),ae=n(235),ie=n(236),re=n(226),ce=Object(M.a)(V||(V=Object(D.a)(["\nsubscription getSongs {\n    songs(order_by: {create_at: desc}) {\n      artist\n      duration\n      id\n      thumbnail\n      title\n      url\n    }\n  }"])));var oe=Object(s.a)((function(e){return{container:{margin:e.spacing(3)},songInfoContainer:{display:"flex",alignItems:"center"},songInfo:{width:"100%",display:"flex",justifyContent:"space-between"},thumbnail:{width:140,height:140,objectFit:"cover",display:"block",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"top left",flex:"1 0 auto"}}}));function se(e){var t=e.song,n=oe(),a=Object(R.a)(U,{onCompleted:function(e){localStorage.setItem("queue",JSON.stringify(e.addOrRemoveFromQueue))}}),r=Object(o.a)(a,1)[0],c=Object(R.a)(L),s=Object(o.a)(c,1)[0],l=i.a.useContext(Ce),u=l.state,j=l.dispatch,p=i.a.useState(!1),O=Object(o.a)(p,2),g=O[0],h=O[1],m=t.thumbnail,x=t.artist,v=t.title,w=t.id;function N(){return N=Object(y.a)(f.a.mark((function e(t){var n,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.id,!window.confirm("Do you want to remove this song from your music library?")){e.next=7;break}return e.next=5,s({variables:{id:n}});case 5:a=e.sent,console.log("deleted song",a);case 7:case"end":return e.stop()}}),e)}))),N.apply(this,arguments)}return i.a.useEffect((function(){var e=u.isPlaying&&w===u.song.id;h(e)}),[w,u.song.id,u.isPlaying]),Object(b.jsx)(Y.a,{className:n.container,children:Object(b.jsxs)("div",{className:n.songInfoContainer,children:[Object(b.jsx)(K.a,{image:m,className:n.thumbnail}),Object(b.jsxs)("div",{className:n.songInfo,children:[Object(b.jsxs)(X.a,{children:[Object(b.jsx)(d.a,{gutterBottom:!0,variant:"h5",component:"h2",children:v}),Object(b.jsx)(d.a,{variant:"body1",component:"p",color:"textSecondary",children:x})]}),Object(b.jsxs)(Z.a,{children:[Object(b.jsx)(ee.a,{onClick:function(){j({type:"SET_SONG",payload:{song:t}}),j(u.isPlaying?{type:"PAUSE_SONG"}:{type:"PLAY_SONG"})},size:"small",color:"primary",children:g?Object(b.jsx)(te.a,{}):Object(b.jsx)(ne.a,{})}),Object(b.jsx)(ee.a,{onClick:function(){r({variables:{input:Object(S.a)(Object(S.a)({},t),{},{__typename:"Song"})}})},size:"small",color:"secondary",children:Object(b.jsx)(ae.a,{})}),Object(b.jsx)(ee.a,{onClick:function(){return function(e){return N.apply(this,arguments)}(t)},size:"small",children:Object(b.jsx)(ie.a,{color:"error"})})]})]})]})})}var le=function(){var e=Object(re.a)(ce),t=e.data,n=e.loading,a=e.error;return n?Object(b.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:50},children:Object(b.jsx)(W.a,{})}):a?Object(b.jsx)("div",{children:"Error fetching songs"}):Object(b.jsx)("div",{children:t.songs.map((function(e){return Object(b.jsx)(se,{song:e},e.id)}))})},ue=n(237),de=n(253);var je=Object(s.a)({avatar:{width:44,height:44},text:{textOverflow:"ellipsis",overflow:"hidden"},container:{display:"grid",gridAutoFlow:"column",gridTemplateColumns:"50px auto 50px",gridGap:12,alignItems:"center",marginTop:10},songInfoContainer:{overflow:"hidden",whiteSpace:"nowrap"}});function be(e){var t=e.song,n=je(),a=Object(R.a)(U,{onCompleted:function(e){localStorage.setItem("queue",JSON.stringify(e.addOrRemoveFromQueue))}}),i=Object(o.a)(a,1)[0],r=t.thumbnail,c=t.artist,s=t.title;return Object(b.jsxs)("div",{className:n.container,children:[Object(b.jsx)(de.a,{className:n.avatar,src:r,alt:"Song Thumbnail"}),Object(b.jsxs)("div",{className:n.songInfoContainer,children:[Object(b.jsx)(d.a,{variant:"subtitle2",className:n.text,children:s}),Object(b.jsx)(d.a,{color:"textSecondary",variant:"body2",className:n.text,children:c})]}),Object(b.jsx)(ee.a,{onClick:function(){i({variables:{input:Object(S.a)(Object(S.a)({},t),{},{__typename:"Song"})}})},children:Object(b.jsx)(ie.a,{color:"error"})})]})}var pe,Oe=function(e){var t=e.queue,n=Object(ue.a)((function(e){return e.breakpoints.up("md")}));return n&&Object(b.jsxs)("div",{style:{margin:"10px 0"},children:[Object(b.jsxs)(d.a,{color:"textSecondary",variant:"button",children:["QUEUE (",t.length,")"]}),t.map((function(e,t){return Object(b.jsx)(be,{song:e},t)}))]})},ge=n(255),he=n(239),me=n(240),xe=n(238),fe=Object(M.a)(pe||(pe=Object(D.a)(["\n    query getQueuedSongs {\n        queue @client {\n            id\n            duration\n            title\n            artist\n            thumbnail\n            url\n        }\n    }\n"]))),ye=Object(s.a)((function(e){return{container:{display:"flex",justifyContent:"space-between"},details:{display:"flex",flexDirection:"column",padding:"0px 15px"},content:{flex:"1 0 auto"},thumbnail:{width:182},controls:{display:"flex",alignItems:"center",paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},playIcon:{width:38,height:38}}}));var ve=function(){var e,t=Object(xe.a)(fe).data,n=i.a.useRef(),a=i.a.useContext(Ce),r=a.state,c=a.dispatch,s=i.a.useState(0),l=Object(o.a)(s,2),u=l[0],j=l[1],p=i.a.useState(0),O=Object(o.a)(p,2),g=O[0],h=O[1],m=i.a.useState(!1),x=Object(o.a)(m,2),f=x[0],y=x[1],v=i.a.useState(0),S=Object(o.a)(v,2),w=S[0],N=S[1],C=ye();return i.a.useEffect((function(){var e=t.queue.findIndex((function(e){return e.id===r.song.id}));N(e)}),[t.queue,r.song.id]),i.a.useEffect((function(){var e=t.queue[w+1];u>=.99&&e&&(j(0),c({type:"SET_SONG",payload:{song:e}}))}),[t.queue,u,c,w]),Object(b.jsxs)(b.Fragment,{children:[Object(b.jsxs)(Y.a,{variant:"outlined",className:C.container,children:[Object(b.jsxs)("div",{className:C.details,children:[Object(b.jsxs)(X.a,{className:C.content,children:[Object(b.jsx)(d.a,{variant:"h5",compenent:"h3",children:r.song.title}),Object(b.jsx)(d.a,{variant:"subtitle1",compenent:"p",color:"textSecondary",children:r.song.artist})]}),Object(b.jsxs)("div",{className:C.controls,children:[Object(b.jsx)(ee.a,{onClick:function(){var e=t.queue[w-1];e&&c({type:"SET_SONG",payload:{song:e}})},children:Object(b.jsx)(he.a,{})}),Object(b.jsx)(ee.a,{onClick:function(){c(r.isPlaying?{type:"PAUSE_SONG"}:{type:"PLAY_SONG"})},children:r.isPlaying?Object(b.jsx)(te.a,{className:C.playIcon}):Object(b.jsx)(ne.a,{className:C.playIcon})}),Object(b.jsx)(ee.a,{onClick:function(){var e=t.queue[w+1];e&&c({type:"SET_SONG",payload:{song:e}})},children:Object(b.jsx)(me.a,{})}),Object(b.jsx)(d.a,{variant:"subtitle1",compenent:"p",color:"textSecondary",children:(e=g,new Date(1e3*e).toISOString().substr(11,8))})]}),Object(b.jsx)(ge.a,{onMouseDown:function(){y(!0)},onMouseUp:function(){y(!1),n.current.seekTo(u)},onChange:function(e,t){j(t)},type:"range",min:0,max:1,step:.01,value:u})]}),Object(b.jsx)(A.a,{ref:n,onProgress:function(e){var t=e.played,n=e.playedSeconds;f||(j(t),h(n))},url:r.song.url,playing:r.isPlaying,hidden:!0}),Object(b.jsx)(K.a,{className:C.thumbnail,image:r.song.thumbnail})]}),Object(b.jsx)(Oe,{queue:t.queue})]})},Se=n(251),we=n(241);var Ne=function(e,t){switch(t.type){case"PLAY_SONG":return Object(S.a)(Object(S.a)({},e),{},{isPlaying:!0});case"PAUSE_SONG":return Object(S.a)(Object(S.a)({},e),{},{isPlaying:!1});case"SET_SONG":return Object(S.a)(Object(S.a)({},e),{},{song:t.payload.song});default:return e}},Ce=i.a.createContext({song:{id:"f8040162-1565-42df-ad95-bb1a96ccc1b5",title:"Mine All Mine",artist:"Van Halen",thumbnail:"http://img.youtube.com/vi/IVH7mHldMOo/0.jpg",url:"https://www.youtube.com/watch?v=IVH7mHldMOo",duration:315},isPlaying:!1});var ke,Ie=function(){var e=i.a.useContext(Ce),t=i.a.useReducer(Ne,e),n=Object(o.a)(t,2),a=n[0],r=n[1],c=Object(ue.a)((function(e){return e.breakpoints.up("sm")})),s=Object(ue.a)((function(e){return e.breakpoints.up("md")}));return Object(b.jsxs)(Ce.Provider,{value:{state:a,dispatch:r},children:[Object(b.jsx)(Se.a,{only:"xs",children:Object(b.jsx)(m,{})}),Object(b.jsxs)(we.a,{container:!0,spacing:3,children:[Object(b.jsxs)(we.a,{style:{paddingTop:c?80:10},item:!0,xs:12,md:7,children:[Object(b.jsx)(z,{}),Object(b.jsx)(le,{})]}),Object(b.jsx)(we.a,{style:s?{position:"fixed",width:"100%",right:0,top:70}:{position:"fixed",width:"100%",left:0,bottom:0},item:!0,xs:12,md:5,children:Object(b.jsx)(ve,{})})]})]})},_e=n(245),qe=n(246),Pe=n(244),Ee=n(129),Te=n(242),Ae=n(243),Fe=Object(Ee.a)({palette:{type:"dark",primary:Te.a,secondary:Ae.a}}),$e=n(57),Ge=n(122),Qe=n(127),Re=n(130),De=new Ge.a({link:new Qe.a({uri:"wss://apollo-music-share-build.herokuapp.com/v1/graphql",options:{reconnect:!0}}),cache:new Re.a,typeDefs:Object(M.a)(ke||(ke=Object(D.a)(["\n    type Song {\n        id: uuid!\n        title: String!\n        artist: String!\n        thumbnail: String!\n        url: String!\n        duration: Float!\n    }\n\n    input SongInput {\n        id: uuid!\n        title: String!\n        artist: String!\n        thumbnail: String!\n        url: String!\n        duration: Float!\n    }\n\n    type Query {\n        queue: [Song]!\n    }\n\n    type Mutation {\n        addOrRemoveFromQueue(input: SongInput!): [Song]!\n    }\n    "]))),resolvers:{Mutation:{addOrRemoveFromQueue:function(e,t,n){var a=t.input,i=n.cache,r=i.readQuery({query:fe});if(r){var c=r.queue,o=c.some((function(e){return e.id===a.id}))?c.filter((function(e){return e.id!==a.id})):[].concat(Object($e.a)(c),[a]);return i.writeQuery({query:fe,data:{queue:o}}),o}return[]}}}}),Me={queue:Boolean(localStorage.getItem("queue"))?JSON.parse(localStorage.getItem("queue")):[]};De.writeData({data:Me});var Ue=De;c.a.render(Object(b.jsx)(Pe.a,{client:Ue,children:Object(b.jsxs)(_e.a,{theme:Fe,children:[Object(b.jsx)(qe.a,{}),Object(b.jsx)(Ie,{})]})}),document.getElementById("root"))}},[[179,1,2]]]);
//# sourceMappingURL=main.3c063ca0.chunk.js.map